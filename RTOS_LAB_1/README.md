# lab # 1

**Назначение**

Программное средство «One Time Pad» предназначено для многопоточного шифрования открытого текста одноразовым блокнотом (шифр Вернама), генерируемым с помощью линейного конгруэнтого ГПСЧ.

**Аппарат**

Реализовать ЛКГ — линейный конгруэнтный генератор псевдослучайных чисел (ПСЧ), производящий вычисление псевдослучайной последовательности (ПСП) по реккурентной формуле:
```bash
X(n+1) = (a*X(n) + c) mod m
```
См. https://ru.wikipedia.org/wiki/%D0%9B%D0%B8%D0%BD%D0%B5%D0%B9%D0%BD%D1%8B%D0%B9_%D0%BA%D0%BE%D0%BD%D0%B3%D1%80%D1%83%D1%8D%D0%BD%D1%82%D0%BD%D1%8B%D0%B9_%D0%BC%D0%B5%D1%82%D0%BE%D0%B4

Несколько слов о шифре Вернама:

 https://www.cryptomuseum.com/crypto/otp/index.htm

**Требования**

    • платформа запуска — RTOS QNX Neutrino 6.6;
    • платформа разработки — IDE QNX Momentics;
    • для работы с файлами и потоками использовать POSIX API;
    • ЛКГ реализуется в отдельном потоке;
    • для работы с аргументами терминала использовать функцию getopt() системного API;
    • реализовать обработку базовых ошибок и исключительных ситуаций;
    • шифрование осуществляется в N рабочих потоках (воркерах);
    • число воркеров N = количеству ядер ЦП;
    • воркеры и главный поток синхронизируются с помощью барьера POSIX;
    • количество ядер ЦП получать программно, с помощью специальной функции.

**Входные данные**

    • путь к файлу с открытым текстом;
    • параметры ЛКГ;
    • путь к выходному файлу.

**Вид строки запуска**

otp  -i /path/to/text.txt -o -/path/to/cypher.txt -x0 4212 -a 84589 -c 45989 -m 217728

**Выходные данные**
    • шифротекст, сохранённый в указанном файле.

**Алгоритм**  

    1. Прочитать параметры командной строки, распаковать их в структуру.
    2. Прочитать файл c открытым текстом в бинарном виде, отобразить в оперативную память. Получить размер файла. Предусмотреть ограничение на размер файла.
    3. Создать ПСП по прочитанным параметрам с помощью ЛКГ в отдельном потоке pthread API.
    4. Синхронизировать основной поток с рабочим с помощью присоединения.
    5. Создать барьер.
    6. Задекларировать структуру — контекст, содержащую барьер, входные данные для каждого воркера (фрагменты блокнота и открытого текста), а также предусматривающую получение выходных данных от воркера.
    7. Создать N воркеров с помощью функции pthread_create(), передав каждому экземпляр контекста.
    8. Главный поток блокируется по ожиданию барьера.
    9. Каждый воркер производит побитовое сложение по модулю 2 своих фрагментов блокнота и текста и  блокируется по ожиданию барьера.
    10. Когда счётчик n барьера становится равен N + 1 (n = N + 1), главный поток разблокируется и продолжает работу.
    11. Главный поток объединяет и сохраняет данные в выходной файл.
    12. Барьер уничтожается.

**Тест**

    • запустить OTP, зашифровать текст, получить шифротекст;
    • запусть OTP ещё раз, на вход в качестве текста подать шифротекст, получить открытый текст;
    • проверить равенство файлов с помощью diff.

**Критерии оценки**

    1. Проверка корректности работы программы с помощью автотеста.
    2. Проверка соответствия исходного кода программы Требованиям даного задания.
    3. Реализация опционального пункта «Дополнительно».

**Дополнительно**

Измерить продолжительность каждого этапа работы программы otp. Оценить порядок издержек на инициализацию механизмов многопоточности. Оценить предел величины входной последовательности, после которой эффективность от многопоточного выполнения превосходит эти издержки.
